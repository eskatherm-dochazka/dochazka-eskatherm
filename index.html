<!DOCTYPE html>
<html lang="cs">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Evidence doch√°zky - ESKA THERM s.r.o.</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #e53e3e 0%, #2d3748 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: rgba(255, 255, 255, 0.98);
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.15);
        }

        .header {
            text-align: center;
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 3px solid #e53e3e;
        }

        .company-logo {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 20px;
            margin-bottom: 20px;
        }

        .logo-square {
            width: 60px;
            height: 60px;
            background: #e53e3e;
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            position: relative;
        }

        .logo-square::before {
            content: '';
            position: absolute;
            width: 40px;
            height: 40px;
            background: white;
            border-radius: 4px;
        }

        .logo-square::after {
            content: 'ET';
            position: absolute;
            color: #e53e3e;
            font-weight: bold;
            font-size: 16px;
            z-index: 1;
        }

        .company-name {
            font-size: 2.2rem;
            font-weight: bold;
            color: #2d3748;
            letter-spacing: 2px;
        }

        .company-tagline {
            color: #e53e3e;
            font-size: 1.2rem;
            font-weight: 600;
            margin-top: 5px;
        }

        .header h1 {
            color: #2d3748;
            font-size: 2rem;
            margin-top: 15px;
        }

        .demo-info {
            background: linear-gradient(135deg, #e53e3e, #c53030);
            color: white;
            padding: 20px;
            border-radius: 15px;
            margin-bottom: 20px;
            box-shadow: 0 5px 15px rgba(229, 62, 62, 0.3);
        }

        .demo-info h4 {
            margin-bottom: 10px;
            font-size: 1.2rem;
        }

        .demo-info p {
            margin-bottom: 8px;
            opacity: 0.95;
        }

        .login-section {
            background: white;
            padding: 25px;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
            margin-bottom: 30px;
            border: 3px solid #e53e3e;
        }

        .login-form {
            display: grid;
            grid-template-columns: 1fr 1fr auto;
            gap: 15px;
            align-items: end;
            margin-bottom: 20px;
        }

        .user-info {
            display: flex;
            align-items: center;
            gap: 10px;
            font-size: 1.1rem;
            color: #2d3748;
            font-weight: 600;
        }

        .boss-badge {
            background: linear-gradient(45deg, #e53e3e, #c53030);
            color: white;
            padding: 6px 16px;
            border-radius: 20px;
            font-size: 0.9rem;
            font-weight: bold;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .employee-badge {
            background: linear-gradient(45deg, #2d3748, #1a202c);
            color: white;
            padding: 6px 16px;
            border-radius: 20px;
            font-size: 0.9rem;
            font-weight: bold;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .form-group {
            display: flex;
            flex-direction: column;
            gap: 5px;
        }

        .form-group label {
            font-weight: 600;
            color: #2d3748;
            font-size: 0.9rem;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        select, button, input, textarea {
            padding: 12px 18px;
            border-radius: 10px;
            border: 2px solid #e2e8f0;
            font-size: 1rem;
            transition: all 0.3s ease;
            background: white;
            font-family: inherit;
        }

        select:focus, input:focus, textarea:focus {
            outline: none;
            border-color: #e53e3e;
            box-shadow: 0 0 0 3px rgba(229, 62, 62, 0.1);
        }

        button {
            background: linear-gradient(45deg, #e53e3e, #c53030);
            color: white;
            border: none;
            cursor: pointer;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        button:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(229, 62, 62, 0.4);
        }

        button:disabled {
            background: #cbd5e0;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }

        .secondary-btn {
            background: linear-gradient(45deg, #2d3748, #1a202c) !important;
        }

        .secondary-btn:hover {
            box-shadow: 0 8px 25px rgba(45, 55, 72, 0.4) !important;
        }

        .employee-management {
            background: white;
            padding: 25px;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
            margin-bottom: 30px;
            border: 3px solid #e53e3e;
        }

        .section-title {
            color: #e53e3e;
            font-size: 1.5rem;
            margin-bottom: 20px;
            font-weight: bold;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .employee-list {
            display: grid;
            gap: 12px;
            margin-top: 20px;
        }

        .employee-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 18px;
            background: linear-gradient(135deg, #f7fafc, #edf2f7);
            border-radius: 12px;
            border: 2px solid #e2e8f0;
            transition: all 0.3s ease;
        }

        .employee-item:hover {
            border-color: #e53e3e;
            box-shadow: 0 5px 15px rgba(229, 62, 62, 0.1);
        }

        .employee-info {
            display: flex;
            flex-direction: column;
            gap: 5px;
        }

        .employee-name {
            font-weight: 600;
            color: #2d3748;
            font-size: 1.1rem;
        }

        .employee-username {
            font-size: 0.9rem;
            color: #718096;
            font-style: italic;
        }

        .delete-btn {
            background: linear-gradient(45deg, #e53e3e, #c53030);
            padding: 8px 16px;
            font-size: 0.9rem;
        }

        .add-employee-form {
            display: grid;
            grid-template-columns: 1fr 1fr 1fr auto;
            gap: 15px;
            align-items: end;
            margin-bottom: 25px;
            padding: 25px;
            background: linear-gradient(135deg, rgba(229, 62, 62, 0.05), rgba(229, 62, 62, 0.1));
            border-radius: 15px;
            border: 2px solid rgba(229, 62, 62, 0.2);
        }

        .attendance-form {
            background: white;
            padding: 25px;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
            margin-bottom: 30px;
            border: 3px solid #e53e3e;
        }

        .form-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 25px;
        }

        .time-buttons {
            display: flex;
            gap: 10px;
            margin-top: 8px;
        }

        .time-btn {
            background: linear-gradient(45deg, #2d3748, #1a202c);
            padding: 8px 16px;
            font-size: 0.85rem;
            flex: 1;
            border-radius: 8px;
        }

        .vacation-section {
            background: linear-gradient(135deg, rgba(229, 62, 62, 0.08), rgba(229, 62, 62, 0.04));
            padding: 25px;
            border-radius: 15px;
            border: 2px solid rgba(229, 62, 62, 0.3);
            margin-top: 25px;
        }

        .vacation-section h4 {
            color: #e53e3e;
            margin-bottom: 15px;
            font-size: 1.2rem;
            font-weight: bold;
        }

        .vacation-grid {
            display: grid;
            grid-template-columns: 1fr 2fr;
            gap: 20px;
        }

        textarea {
            resize: vertical;
            min-height: 80px;
        }

        .records-section {
            background: white;
            padding: 25px;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
            border: 3px solid #e53e3e;
        }

        .records-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 25px;
            flex-wrap: wrap;
            gap: 15px;
        }

        .date-filter {
            display: flex;
            gap: 10px;
            align-items: center;
        }

        .table-container {
            overflow-x: auto;
            border-radius: 12px;
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.1);
        }

        table {
            width: 100%;
            border-collapse: collapse;
            background: white;
            border-radius: 12px;
            overflow: hidden;
        }

        th {
            background: linear-gradient(45deg, #e53e3e, #c53030);
            color: white;
            padding: 18px 15px;
            text-align: left;
            font-weight: 600;
            font-size: 0.9rem;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        td {
            padding: 15px;
            border-bottom: 1px solid #e2e8f0;
            color: #2d3748;
        }

        tr:hover td {
            background-color: rgba(229, 62, 62, 0.03);
        }

        tr:last-child td {
            border-bottom: none;
        }

        .status-badge {
            padding: 6px 12px;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: bold;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .status-complete {
            background: #c6f6d5;
            color: #22543d;
        }

        .status-incomplete {
            background: #fefcbf;
            color: #744210;
        }

        .status-locked {
            background: #fed7d7;
            color: #742a2a;
        }

        .status-vacation {
            background: rgba(229, 62, 62, 0.1);
            color: #e53e3e;
            font-weight: bold;
        }

        .edit-btn {
            background: linear-gradient(45deg, #2d3748, #1a202c);
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 0.8rem;
            font-weight: 600;
            text-transform: uppercase;
        }

        .alert {
            position: fixed;
            top: 20px;
            right: 20px;
            padding: 15px 25px;
            border-radius: 12px;
            font-weight: 600;
            z-index: 1000;
            max-width: 400px;
            animation: slideIn 0.3s ease;
        }

        .alert-success {
            background: #c6f6d5;
            color: #22543d;
            border: 2px solid #9ae6b4;
        }

        .alert-error {
            background: #fed7d7;
            color: #742a2a;
            border: 2px solid #fc8181;
        }

        .alert-warning {
            background: #fefcbf;
            color: #744210;
            border: 2px solid #f6e05e;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .stat-card {
            background: linear-gradient(135deg, rgba(229, 62, 62, 0.08), rgba(45, 55, 72, 0.05));
            padding: 25px;
            border-radius: 15px;
            text-align: center;
            border: 2px solid rgba(229, 62, 62, 0.2);
            transition: all 0.3s ease;
        }

        .stat-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 30px rgba(229, 62, 62, 0.15);
        }

        .stat-number {
            font-size: 2.5rem;
            font-weight: bold;
            color: #e53e3e;
            margin-bottom: 8px;
        }

        .stat-label {
            color: #2d3748;
            font-size: 0.9rem;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .vacation-info {
            font-size: 0.85rem;
            color: #e53e3e;
            font-style: italic;
            margin-top: 3px;
        }

        @keyframes slideIn {
            from {
                transform: translateY(-20px);
                opacity: 0;
            }
            to {
                transform: translateY(0);
                opacity: 1;
            }
        }

        @media (max-width: 768px) {
            .login-form, .add-employee-form {
                grid-template-columns: 1fr;
            }
            
            .form-grid {
                grid-template-columns: 1fr;
            }
            
            .vacation-grid {
                grid-template-columns: 1fr;
            }
            
            .records-header {
                flex-direction: column;
            }
            
            .company-logo {
                flex-direction: column;
                gap: 10px;
            }
            
            .company-name {
                font-size: 1.8rem;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <div class="company-logo">
                <div class="logo-square"></div>
                <div>
                    <div class="company-name">ESKA THERM</div>
                    <div class="company-tagline">S n√°mi budete v teple</div>
                </div>
            </div>
            <h1>üìã Evidence doch√°zky</h1>
            <div id="currentDateTime"></div>
        </div>

        <div class="demo-info">
            <h4>üíº Syst√©m evidence doch√°zky ESKA THERM</h4>
            <p><strong>Pro zamƒõstnance:</strong> P≈ôihla≈°te se sv√Ωm u≈æivatelsk√Ωm jm√©nem a heslem pro p≈ô√≠stup k syst√©mu</p>
            <p><strong>Kontakt:</strong> V p≈ô√≠padƒõ probl√©m≈Ø s p≈ôihl√°≈°en√≠m se obra≈•te na sv√©ho vedouc√≠ho</p>
        </div>

        <div class="login-section">
            <div id="loginForm">
                <h3 class="section-title">üîê P≈ôihl√°≈°en√≠ do syst√©mu</h3>
                <div class="login-form">
                    <div class="form-group">
                        <label>U≈æivatelsk√© jm√©no</label>
                        <input type="text" id="username" placeholder="Zadejte sv√© u≈æivatelsk√© jm√©no" autocomplete="username">
                    </div>
                    <div class="form-group">
                        <label>Heslo</label>
                        <input type="password" id="password" placeholder="Zadejte sv√© heslo" autocomplete="current-password">
                    </div>
                    <div class="form-group" style="flex-direction: row; align-items: center; gap: 8px;">
                        <input type="checkbox" id="rememberMe" style="width: auto; margin: 0;">
                        <label for="rememberMe" style="margin: 0; text-transform: none; font-size: 0.9rem; color: #2d3748;">Z≈Østat p≈ôihl√°≈°en</label>
                    </div>
                    <button onclick="login()">P≈ôihl√°sit se</button>
                </div>
            </div>

            <div id="userInfo" style="display: none;">
                <div class="user-info">
                    <span id="currentUserDisplay">Nep≈ôihl√°≈°en</span>
                    <span id="userBadge" style="display: none;"></span>
                    <button class="secondary-btn" onclick="logout()">Odhl√°sit se</button>
                </div>
            </div>
        </div>

        <div id="employeeManagement" class="employee-management" style="display: none;">
            <h3 class="section-title">üë• Spr√°va zamƒõstnanc≈Ø</h3>
            <div class="add-employee-form">
                <div class="form-group">
                    <label>Cel√© jm√©no</label>
                    <input type="text" id="newEmployeeName" placeholder="Petr Dvo≈ô√°k">
                </div>
                <div class="form-group">
                    <label>U≈æivatelsk√© jm√©no</label>
                    <input type="text" id="newEmployeeUsername" placeholder="petr.dvorak">
                </div>
                <div class="form-group">
                    <label>Heslo</label>
                    <input type="password" id="newEmployeePassword" placeholder="heslo123">
                </div>
                <button onclick="addEmployee()">P≈ôidat zamƒõstnance</button>
            </div>
            <div id="employeeList" class="employee-list"></div>
        </div>

        <div id="attendanceForm" class="attendance-form" style="display: none;">
            <h3 class="section-title">‚è∞ Z√°znam doch√°zky</h3>
            <div class="form-grid">
                <div class="form-group">
                    <label>P≈ô√≠chod do pr√°ce</label>
                    <input type="time" id="arrivalTime">
                    <div class="time-buttons">
                        <button class="time-btn" onclick="setCurrentTime('arrivalTime')">üìç Teƒè</button>
                    </div>
                </div>
                <div class="form-group">
                    <label>Zaƒç√°tek pauzy</label>
                    <input type="time" id="breakStart">
                    <div class="time-buttons">
                        <button class="time-btn" onclick="setCurrentTime('breakStart')">üìç Teƒè</button>
                    </div>
                </div>
                <div class="form-group">
                    <label>Konec pauzy</label>
                    <input type="time" id="breakEnd">
                    <div class="time-buttons">
                        <button class="time-btn" onclick="setCurrentTime('breakEnd')">üìç Teƒè</button>
                    </div>
                </div>
                <div class="form-group">
                    <label>Odchod z pr√°ce</label>
                    <input type="time" id="departureTime">
                    <div class="time-buttons">
                        <button class="time-btn" onclick="setCurrentTime('departureTime')">üìç Teƒè</button>
                    </div>
                </div>
            </div>
            
            <div class="vacation-section">
                <h4>üèñÔ∏è Hl√°≈°en√≠ volna / dovolen√©</h4>
                <div class="vacation-grid">
                    <div class="form-group">
                        <label>Typ volna</label>
                        <select id="vacationType" onchange="toggleVacationMode()">
                            <option value="">Dnes jsem v pr√°ci</option>
                            <option value="dovolena">üèñÔ∏è Dovolen√°</option>
                            <option value="nemoc">ü§í Nemocensk√°</option>
                            <option value="lekarka">üè• N√°v≈°tƒõva l√©ka≈ôe</option>
                            <option value="osobni">üë§ Osobn√≠ volno</option>
                            <option value="sluzebni">üöó Slu≈æebn√≠ cesta</option>
                            <option value="jine">‚ùì Jin√Ω d≈Øvod</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>Pozn√°mka k volnu</label>
                        <textarea id="vacationNote" placeholder="D≈Øvod volna, kontakt v p≈ô√≠padƒõ nutnosti..."></textarea>
                    </div>
                </div>
            </div>

            <div style="margin-top: 25px;">
                <button onclick="saveAttendance()" id="saveBtn">üíæ Ulo≈æit z√°znam</button>
            </div>
        </div>

        <div class="records-section" id="recordsSection" style="display: none;">
            <div class="records-header">
                <h3 class="section-title">üìä P≈ôehled doch√°zky</h3>
                <div class="date-filter">
                    <input type="date" id="filterDate" onchange="filterByDate()">
                    <button class="secondary-btn" onclick="showAllRecords()">Zobrazit v≈°e</button>
                    <button id="exportBtn" onclick="showExportModal()" style="display: none;">üìÅ Export pro √∫ƒçetn√≠</button>
                </div>
            </div>

            <div id="statsSection" class="stats-grid" style="display: none;">
                <div class="stat-card">
                    <div class="stat-number" id="totalEmployees">0</div>
                    <div class="stat-label">Celkem zamƒõstnanc≈Ø</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number" id="todayPresent">0</div>
                    <div class="stat-label">Dnes v pr√°ci</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number" id="todayVacation">0</div>
                    <div class="stat-label">Dnes na volnu</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number" id="avgArrival">--:--</div>
                    <div class="stat-label">Pr≈Ømƒõrn√Ω p≈ô√≠chod</div>
                </div>
            </div>

            <div class="table-container">
                <table id="attendanceTable">
                    <thead>
                        <tr>
                            <th>Datum</th>
                            <th>Zamƒõstnanec</th>
                            <th>P≈ô√≠chod</th>
                            <th>Pauza</th>
                            <th>Odchod</th>
                            <th>Volno/D≈Øvod</th>
                            <th>Celkem hodin</th>
                            <th>Stav</th>
                            <th id="actionsHeader" style="display: none;">Akce</th>
                        </tr>
                    </thead>
                    <tbody id="attendanceTableBody">
                    </tbody>
                </table>
            </div>
        </div>
    </div>

    <!-- Export Modal -->
    <div id="exportModal" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); z-index: 2000;">
        <div style="position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); background: white; padding: 30px; border-radius: 15px; box-shadow: 0 20px 40px rgba(0,0,0,0.3); max-width: 500px; width: 90%;">
            <h3 style="color: #e53e3e; margin-bottom: 20px; text-align: center;">üìÅ Export dat pro √∫ƒçetn√≠</h3>
            
            <div style="margin-bottom: 20px;">
                <label style="display: block; margin-bottom: 10px; font-weight: 600; color: #2d3748;">Vyberte mƒõs√≠c:</label>
                <select id="exportMonth" style="width: 100%; padding: 12px; border-radius: 8px; border: 2px solid #e2e8f0;">
                    <option value="">Aktu√°ln√≠ mƒõs√≠c</option>
                    <option value="2024-01">Leden 2024</option>
                    <option value="2024-02">√önor 2024</option>
                    <option value="2024-03">B≈ôezen 2024</option>
                    <option value="2024-04">Duben 2024</option>
                    <option value="2024-05">Kvƒõten 2024</option>
                    <option value="2024-06">ƒåerven 2024</option>
                    <option value="2024-07">ƒåervenec 2024</option>
                    <option value="2024-08">Srpen 2024</option>
                    <option value="2024-09">Z√°≈ô√≠ 2024</option>
                    <option value="2024-10">≈ò√≠jen 2024</option>
                    <option value="2024-11">Listopad 2024</option>
                    <option value="2024-12">Prosinec 2024</option>
                </select>
            </div>

            <div style="margin-bottom: 20px;">
                <label style="display: block; margin-bottom: 10px; font-weight: 600; color: #2d3748;">Form√°t souboru:</label>
                <select id="exportFormat" style="width: 100%; padding: 12px; border-radius: 8px; border: 2px solid #e2e8f0;">
                    <option value="excel">üìä Excel (.xlsx) - pro √∫ƒçetn√≠</option>
                    <option value="csv">üìÑ CSV - pro import do jin√Ωch syst√©m≈Ø</option>
                </select>
            </div>

            <div style="display: flex; gap: 15px; justify-content: center; margin-top: 25px;">
                <button onclick="exportData()" style="background: linear-gradient(45deg, #e53e3e, #c53030); color: white; padding: 12px 24px; border: none; border-radius: 8px; cursor: pointer; font-weight: 600;">
                    üíæ St√°hnout soubor
                </button>
                <button onclick="closeExportModal()" style="background: linear-gradient(45deg, #2d3748, #1a202c); color: white; padding: 12px 24px; border: none; border-radius: 8px; cursor: pointer; font-weight: 600;">
                    ‚ùå Zru≈°it
                </button>
            </div>
        </div>
    </div>

    <script>
        let currentUser = '';
        let currentUserData = null;
        let isBoss = false;
        let employees = [];
        let attendanceRecords = [];
        let alertTimeout = null;

        window.addEventListener('load', function() {
            initializeData();
            updateDateTime();
            setInterval(updateDateTime, 1000);
            
            // Pokusit se o automatick√© p≈ôihl√°≈°en√≠
            autoLogin();
        });

        function initializeData() {
            // RESET STAR√ùCH DAT - odkomentujte n√°sleduj√≠c√≠ ≈ô√°dky pro vymaz√°n√≠ star√Ωch dat
            // localStorage.removeItem('eskatherm_employees');
            // localStorage.removeItem('eskatherm_attendance');
            // console.log('Star√° data byla vymaz√°na');
            
            // Naƒçten√≠ zamƒõstnanc≈Ø z localStorage
            const storedEmployees = localStorage.getItem('eskatherm_employees');
            if (storedEmployees) {
                try {
                    employees = JSON.parse(storedEmployees);
                } catch (e) {
                    employees = [];
                    console.log('Chyba p≈ôi naƒç√≠t√°n√≠ zamƒõstnanc≈Ø:', e);
                }
            }

            // Vytvo≈ôen√≠ admin √∫ƒçtu pokud neexistuje
            const adminExists = employees.find(emp => emp.username === 'admin');
            if (!adminExists) {
                employees.push({
                    id: 'admin',
                    username: 'klampfl',           // ‚ö†Ô∏è ZMƒö≈áTE U≈ΩIVATELSK√â JM√âNO
                    password: 'Eskatherm2025',     // ‚ö†Ô∏è ZMƒö≈áTE HESLO
                    name: 'Administr√°tor ESKA THERM',
                    isAdmin: true
                });
                saveEmployees();
                console.log('Nov√Ω admin √∫ƒçet byl vytvo≈ôen');
            } else {
                // Aktualizace existuj√≠c√≠ho admin √∫ƒçtu
                const adminIndex = employees.findIndex(emp => emp.username === 'admin');
                if (adminIndex >= 0) {
                    employees[adminIndex] = {
                        ...employees[adminIndex],
                        username: 'klampfl',           // ‚ö†Ô∏è ZMƒö≈áTE U≈ΩIVATELSK√â JM√âNO
                        password: 'Eskatherm2025',     // ‚ö†Ô∏è ZMƒö≈áTE HESLO
                        name: 'Administr√°tor ESKA THERM'
                    };
                    saveEmployees();
                    console.log('Admin √∫ƒçet byl aktualizov√°n');
                }
            }

            // Vytvo≈ôen√≠ demo zamƒõstnanc≈Ø pouze pro testov√°n√≠ - ODEBERTE V OSTR√âM PROVOZU
            const demoEmployees = [
                {
                    id: 'demo1',
                    username: 'jan.novak',
                    password: 'demo123',
                    name: 'Jan Nov√°k (DEMO)',
                    isAdmin: false
                },
                {
                    id: 'demo2',
                    username: 'marie.svoboda',
                    password: 'demo123',
                    name: 'Marie Svobodov√° (DEMO)',
                    isAdmin: false
                }
            ];

            // POZN√ÅMKA: Tento blok odeberte v ostr√©m provozu
            demoEmployees.forEach(emp => {
                if (!employees.find(e => e.username === emp.username)) {
                    employees.push(emp);
                }
            });

            // Naƒçten√≠ z√°znam≈Ø doch√°zky
            const storedRecords = localStorage.getItem('eskatherm_attendance');
            if (storedRecords) {
                try {
                    attendanceRecords = JSON.parse(storedRecords);
                } catch (e) {
                    attendanceRecords = [];
                    console.log('Chyba p≈ôi naƒç√≠t√°n√≠ doch√°zky:', e);
                }
            }

            // Vytvo≈ôen√≠ demo z√°znam≈Ø
            if (attendanceRecords.length === 0) {
                createDemoRecords();
            }

            saveEmployees();
            saveAttendanceRecords();
            updateEmployeeList();
        }

        function createDemoRecords() {
            const today = new Date();
            const yesterday = new Date(today);
            yesterday.setDate(yesterday.getDate() - 1);
            const twoDaysAgo = new Date(today);
            twoDaysAgo.setDate(twoDaysAgo.getDate() - 2);
            
            attendanceRecords = [
                {
                    date: formatDate(yesterday),
                    employeeId: 'demo1',
                    employeeName: 'Jan Nov√°k',
                    arrival: '07:30',
                    breakStart: '12:00',
                    breakEnd: '12:30',
                    departure: '15:30',
                    vacationType: '',
                    vacationNote: '',
                    isLocked: true
                },
                {
                    date: formatDate(yesterday),
                    employeeId: 'demo2',
                    employeeName: 'Marie Svobodov√°',
                    arrival: '',
                    breakStart: '',
                    breakEnd: '',
                    departure: '',
                    vacationType: 'dovolena',
                    vacationNote: 'Rodinn√° dovolen√° u mo≈ôe',
                    isLocked: true
                },
                {
                    date: formatDate(twoDaysAgo),
                    employeeId: 'demo1',
                    employeeName: 'Jan Nov√°k',
                    arrival: '08:00',
                    breakStart: '12:15',
                    breakEnd: '12:45',
                    departure: '16:00',
                    vacationType: '',
                    vacationNote: '',
                    isLocked: true
                }
            ];
        }

        function updateDateTime() {
            const now = new Date();
            const options = {
                weekday: 'long',
                year: 'numeric',
                month: 'long',
                day: 'numeric',
                hour: '2-digit',
                minute: '2-digit',
                second: '2-digit'
            };
            document.getElementById('currentDateTime').textContent = now.toLocaleDateString('cs-CZ', options);
        }

        function formatDate(date) {
            return date.toISOString().split('T')[0];
        }

        function showAlert(message, type) {
            // Odstranit existuj√≠c√≠ alert
            const existingAlert = document.querySelector('.alert');
            if (existingAlert) {
                existingAlert.remove();
            }

            if (alertTimeout) {
                clearTimeout(alertTimeout);
            }

            const alert = document.createElement('div');
            alert.className = `alert alert-${type}`;
            alert.textContent = message;
            
            document.body.appendChild(alert);

            alertTimeout = setTimeout(() => {
                if (alert.parentNode) {
                    alert.remove();
                }
            }, 4000);
        }

        function saveEmployees() {
            try {
                localStorage.setItem('eskatherm_employees', JSON.stringify(employees));
            } catch (e) {
                console.error('Chyba p≈ôi ukl√°d√°n√≠ zamƒõstnanc≈Ø:', e);
                showAlert('Chyba p≈ôi ukl√°d√°n√≠ dat!', 'error');
            }
        }

        function saveAttendanceRecords() {
            try {
                localStorage.setItem('eskatherm_attendance', JSON.stringify(attendanceRecords));
            } catch (e) {
                console.error('Chyba p≈ôi ukl√°d√°n√≠ doch√°zky:', e);
                showAlert('Chyba p≈ôi ukl√°d√°n√≠ dat!', 'error');
            }
        }

        function login() {
            const username = document.getElementById('username').value.trim();
            const password = document.getElementById('password').value;
            const rememberMe = document.getElementById('rememberMe').checked;

            if (!username || !password) {
                showAlert('Pros√≠m vypl≈àte u≈æivatelsk√© jm√©no a heslo!', 'error');
                return;
            }

            const user = employees.find(emp => emp.username === username && emp.password === password);
            
            if (!user) {
                showAlert('Nespr√°vn√© u≈æivatelsk√© jm√©no nebo heslo!', 'error');
                return;
            }

            // Ulo≈æen√≠ p≈ôihla≈°ovac√≠ch √∫daj≈Ø pokud je za≈°krtnuto "Z≈Østat p≈ôihl√°≈°en"
            if (rememberMe) {
                try {
                    const loginData = {
                        username: username,
                        password: password,
                        timestamp: Date.now(),
                        expires: Date.now() + (30 * 24 * 60 * 60 * 1000) // 30 dn√≠
                    };
                    localStorage.setItem('eskatherm_remember_login', JSON.stringify(loginData));
                } catch (e) {
                    console.log('Nepoda≈ôilo se ulo≈æit p≈ôihla≈°ovac√≠ √∫daje:', e);
                }
            } else {
                // Vymaz√°n√≠ ulo≈æen√Ωch p≈ôihla≈°ovac√≠ch √∫daj≈Ø
                localStorage.removeItem('eskatherm_remember_login');
            }

            performLogin(user);
        }

        function autoLogin() {
            try {
                const savedLogin = localStorage.getItem('eskatherm_remember_login');
                if (!savedLogin) return;

                const loginData = JSON.parse(savedLogin);
                
                // Kontrola vypr≈°en√≠ platnosti (30 dn√≠)
                if (Date.now() > loginData.expires) {
                    localStorage.removeItem('eskatherm_remember_login');
                    return;
                }

                // Pokus o automatick√© p≈ôihl√°≈°en√≠
                const user = employees.find(emp => 
                    emp.username === loginData.username && 
                    emp.password === loginData.password
                );

                if (user) {
                    // Vyplnƒõn√≠ formul√°≈ôe
                    document.getElementById('username').value = loginData.username;
                    document.getElementById('rememberMe').checked = true;
                    
                    // Automatick√© p≈ôihl√°≈°en√≠
                    performLogin(user);
                    showAlert('Automaticky p≈ôihl√°≈°en jako: ' + user.name, 'success');
                } else {
                    // U≈æivatel u≈æ neexistuje nebo zmƒõnil heslo
                    localStorage.removeItem('eskatherm_remember_login');
                }
            } catch (e) {
                console.log('Chyba p≈ôi automatick√©m p≈ôihl√°≈°en√≠:', e);
                localStorage.removeItem('eskatherm_remember_login');
            }
        }

        function performLogin(user) {
            currentUser = user.username;
            currentUserData = user;
            isBoss = user.isAdmin || false;

            // Skryt√≠ p≈ôihla≈°ovac√≠ho formul√°≈ôe
            document.getElementById('loginForm').style.display = 'none';
            document.getElementById('userInfo').style.display = 'block';
            
            // Zobrazen√≠ u≈æivatelsk√Ωch informac√≠
            document.getElementById('currentUserDisplay').textContent = user.name;
            const badge = document.getElementById('userBadge');
            badge.style.display = 'inline-block';
            badge.textContent = isBoss ? 'ADMIN' : 'ZAMƒöSTNANEC';
            badge.className = isBoss ? 'boss-badge' : 'employee-badge';

            // Zobrazen√≠ p≈ô√≠slu≈°n√Ωch sekc√≠
            if (isBoss) {
                document.getElementById('employeeManagement').style.display = 'block';
                document.getElementById('statsSection').style.display = 'grid';
                document.getElementById('actionsHeader').style.display = 'table-cell';
                document.getElementById('exportBtn').style.display = 'inline-block';
                document.getElementById('recordsSection').style.display = 'block';
                document.getElementById('showAllBtn').textContent = 'Zobrazit v≈°e';
                document.getElementById('recordsTitle').textContent = 'üìä P≈ôehled doch√°zky - v≈°ichni zamƒõstnanci';
                updateStats();
                updateEmployeeList();
            } else {
                document.getElementById('attendanceForm').style.display = 'block';
                document.getElementById('recordsSection').style.display = 'block';
                document.getElementById('showAllBtn').textContent = 'Moje z√°znamy';
                document.getElementById('recordsTitle').textContent = 'üìä Moje doch√°zka';
                loadCurrentUserAttendance();
            }

            updateAttendanceTable();

            // Vyƒçi≈°tƒõn√≠ hesla z formul√°≈ôe (bezpeƒçnost)
            document.getElementById('password').value = '';
        }

        function logout() {
            currentUser = '';
            currentUserData = null;
            isBoss = false;

            // Vymaz√°n√≠ ulo≈æen√Ωch p≈ôihla≈°ovac√≠ch √∫daj≈Ø
            localStorage.removeItem('eskatherm_remember_login');

            // Zobrazen√≠ p≈ôihla≈°ovac√≠ho formul√°≈ôe
            document.getElementById('loginForm').style.display = 'block';
            document.getElementById('userInfo').style.display = 'none';

            // Skryt√≠ v≈°ech sekc√≠
            document.getElementById('employeeManagement').style.display = 'none';
            document.getElementById('attendanceForm').style.display = 'none';
            document.getElementById('statsSection').style.display = 'none';
            document.getElementById('actionsHeader').style.display = 'none';
            document.getElementById('exportBtn').style.display = 'none';
            document.getElementById('recordsSection').style.display = 'none';

            // Vyƒçi≈°tƒõn√≠ formul√°≈ôe
            document.getElementById('username').value = '';
            document.getElementById('password').value = '';
            document.getElementById('rememberMe').checked = false;

            updateAttendanceTable();
            showAlert('√öspƒõ≈°nƒõ odhl√°≈°en', 'success');
        }

        function addEmployee() {
            if (!isBoss) {
                showAlert('Nem√°te opr√°vnƒõn√≠ p≈ôid√°vat zamƒõstnance!', 'error');
                return;
            }

            const name = document.getElementById('newEmployeeName').value.trim();
            const username = document.getElementById('newEmployeeUsername').value.trim();
            const password = document.getElementById('newEmployeePassword').value;

            if (!name || !username || !password) {
                showAlert('Pros√≠m vypl≈àte v≈°echna pole!', 'error');
                return;
            }

            if (employees.find(emp => emp.username === username)) {
                showAlert('U≈æivatelsk√© jm√©no ji≈æ existuje!', 'error');
                return;
            }

            const newEmployee = {
                id: Date.now().toString(),
                username: username,
                password: password,
                name: name,
                isAdmin: false
            };

            employees.push(newEmployee);
            saveEmployees();
            updateEmployeeList();
            updateStats();

            // Vyƒçi≈°tƒõn√≠ formul√°≈ôe
            document.getElementById('newEmployeeName').value = '';
            document.getElementById('newEmployeeUsername').value = '';
            document.getElementById('newEmployeePassword').value = '';

            showAlert('Zamƒõstnanec byl √∫spƒõ≈°nƒõ p≈ôid√°n!', 'success');
        }

        function deleteEmployee(employeeId) {
            if (!isBoss) {
                showAlert('Nem√°te opr√°vnƒõn√≠ mazat zamƒõstnance!', 'error');
                return;
            }

            if (employeeId === 'admin') {
                showAlert('Admin √∫ƒçet nelze smazat!', 'error');
                return;
            }

            const employee = employees.find(emp => emp.id === employeeId);
            if (!employee) {
                showAlert('Zamƒõstnanec nenalezen!', 'error');
                return;
            }

            if (confirm('Opravdu chcete smazat zamƒõstnance ' + employee.name + '? V≈°echny jeho z√°znamy budou tak√© smaz√°ny.')) {
                // Smaz√°n√≠ zamƒõstnance
                employees = employees.filter(emp => emp.id !== employeeId);
                
                // Smaz√°n√≠ v≈°ech z√°znam≈Ø tohoto zamƒõstnance
                attendanceRecords = attendanceRecords.filter(record => record.employeeId !== employeeId);
                
                saveEmployees();
                saveAttendanceRecords();
                updateEmployeeList();
                updateAttendanceTable();
                updateStats();
                
                showAlert('Zamƒõstnanec byl smaz√°n!', 'success');
            }
        }

        function updateEmployeeList() {
            if (!isBoss) return;

            const employeeList = document.getElementById('employeeList');
            employeeList.innerHTML = '';

            const regularEmployees = employees.filter(emp => !emp.isAdmin);
            
            if (regularEmployees.length === 0) {
                employeeList.innerHTML = '<p style="text-align: center; color: #718096; font-style: italic; padding: 20px;">≈Ω√°dn√≠ zamƒõstnanci nejsou p≈ôid√°ni. P≈ôidejte je pomoc√≠ formul√°≈ôe v√Ω≈°e.</p>';
                return;
            }

            regularEmployees.forEach(employee => {
                const employeeItem = document.createElement('div');
                employeeItem.className = 'employee-item';
                employeeItem.innerHTML = `
                    <div class="employee-info">
                        <div class="employee-name">${employee.name}</div>
                        <div class="employee-username">P≈ôihl√°≈°en√≠: ${employee.username} | Heslo: ${employee.password}</div>
                    </div>
                    <button class="delete-btn" onclick="deleteEmployee('${employee.id}')">üóëÔ∏è Smazat</button>
                `;
                employeeList.appendChild(employeeItem);
            });
        }

        function toggleVacationMode() {
            const vacationType = document.getElementById('vacationType').value;
            const timeInputs = ['arrivalTime', 'breakStart', 'breakEnd', 'departureTime'];
            const isVacation = vacationType !== '';

            timeInputs.forEach(inputId => {
                const input = document.getElementById(inputId);
                input.disabled = isVacation;
                if (isVacation) {
                    input.value = '';
                }
            });

            // Zmƒõna barvy formul√°≈ôe kdy≈æ je volno
            const formGrid = document.querySelector('.form-grid');
            if (isVacation) {
                formGrid.style.opacity = '0.5';
            } else {
                formGrid.style.opacity = '1';
            }
        }

        function loadCurrentUserAttendance() {
            const today = formatDate(new Date());
            const todayRecord = attendanceRecords.find(r => 
                r.date === today && r.employeeId === currentUserData.id
            );

            if (todayRecord && !isRecordLocked(todayRecord)) {
                document.getElementById('arrivalTime').value = todayRecord.arrival || '';
                document.getElementById('breakStart').value = todayRecord.breakStart || '';
                document.getElementById('breakEnd').value = todayRecord.breakEnd || '';
                document.getElementById('departureTime').value = todayRecord.departure || '';
                document.getElementById('vacationType').value = todayRecord.vacationType || '';
                document.getElementById('vacationNote').value = todayRecord.vacationNote || '';
                
                toggleVacationMode();
            } else {
                // Vyƒçi≈°tƒõn√≠ formul√°≈ôe
                document.getElementById('arrivalTime').value = '';
                document.getElementById('breakStart').value = '';
                document.getElementById('breakEnd').value = '';
                document.getElementById('departureTime').value = '';
                document.getElementById('vacationType').value = '';
                document.getElementById('vacationNote').value = '';
            }

            const isLocked = todayRecord && isRecordLocked(todayRecord);
            const inputs = ['arrivalTime', 'breakStart', 'breakEnd', 'departureTime', 'vacationType', 'vacationNote'];
            const saveBtn = document.getElementById('saveBtn');
            
            inputs.forEach(inputId => {
                document.getElementById(inputId).disabled = isLocked;
            });
            saveBtn.disabled = isLocked;

            if (isLocked) {
                showAlert('Dne≈°n√≠ z√°znam je ji≈æ uzamƒçen a nelze ho upravovat', 'warning');
            }
        }

        function isRecordLocked(record) {
            const recordDate = new Date(record.date + 'T00:00:00');
            const today = new Date();
            today.setHours(0, 0, 0, 0);
            return recordDate < today || record.isLocked;
        }

        function setCurrentTime(inputId) {
            const now = new Date();
            const timeString = now.toTimeString().substr(0, 5);
            document.getElementById(inputId).value = timeString;
        }

        function saveAttendance() {
            if (!currentUserData) {
                showAlert('Nejste p≈ôihl√°≈°en!', 'error');
                return;
            }

            const today = formatDate(new Date());
            const arrival = document.getElementById('arrivalTime').value;
            const breakStart = document.getElementById('breakStart').value;
            const breakEnd = document.getElementById('breakEnd').value;
            const departure = document.getElementById('departureTime').value;
            const vacationType = document.getElementById('vacationType').value;
            const vacationNote = document.getElementById('vacationNote').value;

            // Pokud je na volnu, nepot≈ôebujeme ƒçasy
            if (!vacationType && !arrival) {
                showAlert('P≈ô√≠chod je povinn√Ω, pokud nejste na volnu!', 'error');
                return;
            }

            // Validace ƒças≈Ø pouze pokud nen√≠ na volnu
            if (!vacationType) {
                if (breakStart && breakEnd && breakStart >= breakEnd) {
                    showAlert('Konec pauzy mus√≠ b√Ωt po zaƒç√°tku pauzy!', 'error');
                    return;
                }

                if (departure && arrival >= departure) {
                    showAlert('Odchod mus√≠ b√Ωt po p≈ô√≠chodu!', 'error');
                    return;
                }
            }

            // Naj√≠t existuj√≠c√≠ z√°znam pro dne≈°n√≠ den
            let existingRecordIndex = attendanceRecords.findIndex(r => 
                r.date === today && r.employeeId === currentUserData.id
            );

            const recordData = {
                date: today,
                employeeId: currentUserData.id,
                employeeName: currentUserData.name,
                arrival: vacationType ? '' : arrival,
                breakStart: vacationType ? '' : breakStart,
                breakEnd: vacationType ? '' : breakEnd,
                departure: vacationType ? '' : departure,
                vacationType: vacationType,
                vacationNote: vacationNote,
                isLocked: false
            };

            if (existingRecordIndex >= 0) {
                // Kontrola uzamƒçen√≠
                if (isRecordLocked(attendanceRecords[existingRecordIndex])) {
                    showAlert('Tento z√°znam je ji≈æ uzamƒçen a nelze ho upravovat!', 'error');
                    return;
                }
                attendanceRecords[existingRecordIndex] = recordData;
            } else {
                attendanceRecords.push(recordData);
            }

            saveAttendanceRecords();
            updateAttendanceTable();
            
            if (isBoss) {
                updateStats();
            }
            
            const message = vacationType ? 'Volno bylo √∫spƒõ≈°nƒõ nahl√°≈°eno!' : 'Doch√°zka byla √∫spƒõ≈°nƒõ ulo≈æena!';
            showAlert(message, 'success');
        }

        function editRecord(index) {
            if (!isBoss) {
                showAlert('Nem√°te opr√°vnƒõn√≠ upravovat z√°znamy!', 'error');
                return;
            }

            const record = attendanceRecords[index];
            
            // Pokud je z√°znam uzamƒçen
            if (isRecordLocked(record)) {
                if (!confirm('Tento z√°znam je uzamƒçen. Opravdu ho chcete upravit?')) {
                    return;
                }
            }

            const newArrival = prompt('P≈ô√≠chod (HH:MM):', record.arrival || '');
            if (newArrival === null) return;

            const newBreakStart = prompt('Zaƒç√°tek pauzy (HH:MM):', record.breakStart || '');
            if (newBreakStart === null) return;

            const newBreakEnd = prompt('Konec pauzy (HH:MM):', record.breakEnd || '');
            if (newBreakEnd === null) return;

            const newDeparture = prompt('Odchod (HH:MM):', record.departure || '');
            if (newDeparture === null) return;

            // Aktualizace z√°znamu
            attendanceRecords[index] = {
                ...record,
                arrival: newArrival,
                breakStart: newBreakStart,
                breakEnd: newBreakEnd,
                departure: newDeparture
            };

            saveAttendanceRecords();
            updateAttendanceTable();
            updateStats();
            showAlert('Z√°znam byl √∫spƒõ≈°nƒõ upraven!', 'success');
        }

        function calculateWorkHours(record) {
            if (!record.arrival || !record.departure || record.vacationType) {
                return '--';
            }

            const arrivalTime = new Date('2000-01-01T' + record.arrival + ':00');
            const departureTime = new Date('2000-01-01T' + record.departure + ':00');
            
            let workMinutes = (departureTime - arrivalTime) / (1000 * 60);

            // Odeƒçten√≠ pauzy
            if (record.breakStart && record.breakEnd) {
                const breakStartTime = new Date('2000-01-01T' + record.breakStart + ':00');
                const breakEndTime = new Date('2000-01-01T' + record.breakEnd + ':00');
                const breakMinutes = (breakEndTime - breakStartTime) / (1000 * 60);
                workMinutes -= breakMinutes;
            }

            const hours = Math.floor(workMinutes / 60);
            const minutes = Math.round(workMinutes % 60);
            return hours + 'h ' + minutes + 'm';
        }

        function getRecordStatus(record) {
            if (record.vacationType) {
                return { text: 'Volno', class: 'status-vacation' };
            }
            
            const hasAllFields = record.arrival && record.departure && record.breakStart && record.breakEnd;
            const isLocked = isRecordLocked(record);

            if (isLocked) {
                return { text: 'Uzamƒçeno', class: 'status-locked' };
            } else if (hasAllFields) {
                return { text: 'Kompletn√≠', class: 'status-complete' };
            } else {
                return { text: 'Ne√∫pln√©', class: 'status-incomplete' };
            }
        }

        function getVacationTypeText(vacationType) {
            const types = {
                'dovolena': 'üèñÔ∏è Dovolen√°',
                'nemoc': 'ü§í Nemocensk√°',
                'lekarka': 'üè• N√°v≈°tƒõva l√©ka≈ôe',
                'osobni': 'üë§ Osobn√≠ volno',
                'sluzebni': 'üöó Slu≈æebn√≠ cesta',
                'jine': '‚ùì Jin√Ω d≈Øvod'
            };
            return types[vacationType] || '--';
        }

        function updateAttendanceTable() {
            const tbody = document.getElementById('attendanceTableBody');
            tbody.innerHTML = '';

            let filteredRecords = [...attendanceRecords];
            
            // Pokud nen√≠ admin, zobrazit pouze z√°znamy aktu√°ln√≠ho u≈æivatele
            if (!isBoss && currentUserData) {
                filteredRecords = attendanceRecords.filter(r => r.employeeId === currentUserData.id);
            }
            
            const filterDate = document.getElementById('filterDate').value;
            
            if (filterDate) {
                filteredRecords = filteredRecords.filter(r => r.date === filterDate);
            }

            // Se≈ôadit podle data (nejnovƒõj≈°√≠ prvn√≠)
            filteredRecords.sort((a, b) => new Date(b.date) - new Date(a.date));

            filteredRecords.forEach((record, filteredIndex) => {
                const originalIndex = attendanceRecords.indexOf(record);
                const row = document.createElement('tr');
                const status = getRecordStatus(record);
                const workHours = calculateWorkHours(record);
                
                const breakText = record.breakStart && record.breakEnd ? 
                    record.breakStart + '-' + record.breakEnd : '--';

                const vacationText = record.vacationType ? 
                    getVacationTypeText(record.vacationType) : '--';

                row.innerHTML = `
                    <td>${new Date(record.date).toLocaleDateString('cs-CZ')}</td>
                    <td><strong>${record.employeeName}</strong></td>
                    <td>${record.arrival || '--'}</td>
                    <td>${breakText}</td>
                    <td>${record.departure || '--'}</td>
                    <td>${vacationText}${record.vacationNote ? '<div class="vacation-info">' + record.vacationNote + '</div>' : ''}</td>
                    <td><strong>${workHours}</strong></td>
                    <td><span class="status-badge ${status.class}">${status.text}</span></td>
                    ${isBoss ? '<td><button class="edit-btn" onclick="editRecord(' + originalIndex + ')">‚úèÔ∏è Upravit</button></td>' : ''}
                `;
                tbody.appendChild(row);
            });

            if (filteredRecords.length === 0) {
                const emptyMessage = !isBoss && currentUserData ? 
                    'Nem√°te zat√≠m ≈æ√°dn√© z√°znamy doch√°zky' : 
                    '≈Ω√°dn√© z√°znamy nenalezeny';
                    
                const row = document.createElement('tr');
                row.innerHTML = '<td colspan="' + (isBoss ? 9 : 8) + '" style="text-align: center; color: #718096; font-style: italic; padding: 40px;">' + emptyMessage + '</td>';
                tbody.appendChild(row);
            }
        }

        function updateStats() {
            if (!isBoss) return;

            const today = formatDate(new Date());
            const todayRecords = attendanceRecords.filter(r => r.date === today);
            const presentToday = todayRecords.filter(r => !r.vacationType);
            const vacationToday = todayRecords.filter(r => r.vacationType);
            
            document.getElementById('totalEmployees').textContent = employees.filter(e => !e.isAdmin).length;
            document.getElementById('todayPresent').textContent = presentToday.length;
            document.getElementById('todayVacation').textContent = vacationToday.length;

            // Pr≈Ømƒõrn√Ω p≈ô√≠chod
            const arrivals = presentToday.filter(r => r.arrival).map(r => r.arrival);
            if (arrivals.length > 0) {
                const avgMinutes = arrivals.reduce((sum, time) => {
                    const parts = time.split(':');
                    const hours = parseInt(parts[0]);
                    const minutes = parseInt(parts[1]);
                    return sum + hours * 60 + minutes;
                }, 0) / arrivals.length;
                
                const avgHours = Math.floor(avgMinutes / 60);
                const avgMins = Math.round(avgMinutes % 60);
                const avgTime = (avgHours < 10 ? '0' : '') + avgHours + ':' + (avgMins < 10 ? '0' : '') + avgMins;
                document.getElementById('avgArrival').textContent = avgTime;
            } else {
                document.getElementById('avgArrival').textContent = '--:--';
            }
        }

        function filterByDate() {
            updateAttendanceTable();
        }

        function showAllRecords() {
            document.getElementById('filterDate').value = '';
            updateAttendanceTable();
        }

        function showEmployeeRecords() {
            // Funkce pro zobrazen√≠ pouze z√°znam≈Ø aktu√°ln√≠ho zamƒõstnance
            if (!isBoss && currentUserData) {
                updateAttendanceTable(); // Automaticky filtruje podle u≈æivatele
            }
        }

        function showExportModal() {
            if (!isBoss) {
                showAlert('Nem√°te opr√°vnƒõn√≠ exportovat data!', 'error');
                return;
            }
            
            // Naplnƒõn√≠ mƒõs√≠c≈Ø dynamicky
            const exportMonth = document.getElementById('exportMonth');
            exportMonth.innerHTML = '<option value="">Aktu√°ln√≠ mƒõs√≠c</option>';
            
            const currentDate = new Date();
            for (let i = 11; i >= 0; i--) {
                const date = new Date(currentDate.getFullYear(), currentDate.getMonth() - i, 1);
                const year = date.getFullYear();
                const month = String(date.getMonth() + 1).padStart(2, '0');
                const monthNames = ['Leden', '√önor', 'B≈ôezen', 'Duben', 'Kvƒõten', 'ƒåerven', 
                                  'ƒåervenec', 'Srpen', 'Z√°≈ô√≠', '≈ò√≠jen', 'Listopad', 'Prosinec'];
                
                const option = document.createElement('option');
                option.value = `${year}-${month}`;
                option.textContent = `${monthNames[date.getMonth()]} ${year}`;
                exportMonth.appendChild(option);
            }
            
            document.getElementById('exportModal').style.display = 'block';
        }

        function closeExportModal() {
            document.getElementById('exportModal').style.display = 'none';
        }

        function exportData() {
            const selectedMonth = document.getElementById('exportMonth').value;
            const format = document.getElementById('exportFormat').value;
            
            let filteredRecords = attendanceRecords;
            let fileName = 'dochazka_ESKA_THERM';
            
            if (selectedMonth) {
                filteredRecords = attendanceRecords.filter(record => {
                    return record.date.startsWith(selectedMonth);
                });
                const monthYear = selectedMonth.split('-');
                const monthNames = ['leden', 'unor', 'brezen', 'duben', 'kveten', 'cerven', 
                                  'cervenec', 'srpen', 'zari', 'rijen', 'listopad', 'prosinec'];
                fileName = `dochazka_ESKA_THERM_${monthNames[parseInt(monthYear[1]) - 1]}_${monthYear[0]}`;
            } else {
                const currentDate = new Date();
                const currentMonth = currentDate.toISOString().substring(0, 7);
                filteredRecords = attendanceRecords.filter(record => {
                    return record.date.startsWith(currentMonth);
                });
                const monthNames = ['leden', 'unor', 'brezen', 'duben', 'kveten', 'cerven', 
                                  'cervenec', 'srpen', 'zari', 'rijen', 'listopad', 'prosinec'];
                fileName = `dochazka_ESKA_THERM_${monthNames[currentDate.getMonth()]}_${currentDate.getFullYear()}`;
            }
            
            if (filteredRecords.length === 0) {
                showAlert('≈Ω√°dn√© z√°znamy pro vybran√Ω mƒõs√≠c!', 'warning');
                return;
            }

            if (format === 'excel') {
                exportToExcel(filteredRecords, fileName);
            } else {
                exportToCSV(filteredRecords, fileName);
            }
            
            closeExportModal();
            showAlert(`Export dokonƒçen! Soubor ${fileName} byl sta≈æen.`, 'success');
        }

        function exportToCSV(records, fileName) {
            const headers = [
                'Datum',
                'Zamƒõstnanec',
                'P≈ô√≠chod',
                'Zaƒç√°tek pauzy',
                'Konec pauzy',
                'Odchod',
                'Celkem hodin',
                'Typ volna',
                'Pozn√°mka k volnu',
                'Stav'
            ];
            
            let csv = headers.join(',') + '\n';
            
            records.sort((a, b) => new Date(a.date) - new Date(b.date));
            
            records.forEach(record => {
                const workHours = calculateWorkHours(record);
                const status = getRecordStatus(record);
                const vacationType = record.vacationType ? getVacationTypeText(record.vacationType) : '';
                
                const row = [
                    new Date(record.date).toLocaleDateString('cs-CZ'),
                    `"${record.employeeName}"`,
                    record.arrival || '',
                    record.breakStart || '',
                    record.breakEnd || '',
                    record.departure || '',
                    workHours,
                    `"${vacationType}"`,
                    `"${record.vacationNote || ''}"`,
                    `"${status.text}"`
                ];
                
                csv += row.join(',') + '\n';
            });
            
            downloadFile(csv, fileName + '.csv', 'text/csv;charset=utf-8;');
        }

        function exportToExcel(records, fileName) {
            // Simulace Excel exportu pomoc√≠ HTML tabulky
            let html = `
                <html>
                <head>
                    <meta charset="UTF-8">
                    <style>
                        body { font-family: Arial, sans-serif; margin: 20px; }
                        .header { background-color: #e53e3e; color: white; padding: 15px; text-align: center; margin-bottom: 20px; }
                        table { border-collapse: collapse; width: 100%; }
                        th, td { border: 1px solid #ddd; padding: 8px; text-align: left; }
                        th { background-color: #e53e3e; color: white; font-weight: bold; }
                        .vacation { background-color: #ffe6e6; }
                        .summary { margin-top: 30px; padding: 15px; background-color: #f5f5f5; }
                    </style>
                </head>
                <body>
                    <div class="header">
                        <h1>ESKA THERM s.r.o. - Evidence doch√°zky</h1>
                        <p>Vygenerov√°no: ${new Date().toLocaleDateString('cs-CZ')}</p>
                    </div>
                    <table>
                        <thead>
                            <tr>
                                <th>Datum</th>
                                <th>Zamƒõstnanec</th>
                                <th>P≈ô√≠chod</th>
                                <th>Zaƒç√°tek pauzy</th>
                                <th>Konec pauzy</th>
                                <th>Odchod</th>
                                <th>Celkem hodin</th>
                                <th>Typ volna</th>
                                <th>Pozn√°mka</th>
                                <th>Stav</th>
                            </tr>
                        </thead>
                        <tbody>
            `;
            
            records.sort((a, b) => new Date(a.date) - new Date(b.date));
            let totalWorkMinutes = 0;
            let workDays = 0;
            let vacationDays = 0;
            
            records.forEach(record => {
                const workHours = calculateWorkHours(record);
                const status = getRecordStatus(record);
                const vacationType = record.vacationType ? getVacationTypeText(record.vacationType) : '';
                const isVacation = record.vacationType ? ' class="vacation"' : '';
                
                if (record.vacationType) {
                    vacationDays++;
                } else if (record.arrival && record.departure) {
                    workDays++;
                    // V√Ωpoƒçet minut pro celkov√Ω souƒçet
                    const arrivalTime = new Date('2000-01-01T' + record.arrival + ':00');
                    const departureTime = new Date('2000-01-01T' + record.departure + ':00');
                    let workMinutes = (departureTime - arrivalTime) / (1000 * 60);
                    if (record.breakStart && record.breakEnd) {
                        const breakStartTime = new Date('2000-01-01T' + record.breakStart + ':00');
                        const breakEndTime = new Date('2000-01-01T' + record.breakEnd + ':00');
                        const breakMinutes = (breakEndTime - breakStartTime) / (1000 * 60);
                        workMinutes -= breakMinutes;
                    }
                    totalWorkMinutes += workMinutes;
                }
                
                html += `
                    <tr${isVacation}>
                        <td>${new Date(record.date).toLocaleDateString('cs-CZ')}</td>
                        <td><strong>${record.employeeName}</strong></td>
                        <td>${record.arrival || '--'}</td>
                        <td>${record.breakStart || '--'}</td>
                        <td>${record.breakEnd || '--'}</td>
                        <td>${record.departure || '--'}</td>
                        <td><strong>${workHours}</strong></td>
                        <td>${vacationType}</td>
                        <td>${record.vacationNote || '--'}</td>
                        <td>${status.text}</td>
                    </tr>
                `;
            });
            
            const totalHours = Math.floor(totalWorkMinutes / 60);
            const totalMinutes = Math.round(totalWorkMinutes % 60);
            
            html += `
                        </tbody>
                    </table>
                    <div class="summary">
                        <h3>Souhrn za obdob√≠:</h3>
                        <p><strong>Poƒçet pracovn√≠ch dn≈Ø:</strong> ${workDays}</p>
                        <p><strong>Poƒçet dn≈Ø volna:</strong> ${vacationDays}</p>
                        <p><strong>Celkem odpracov√°no:</strong> ${totalHours}h ${totalMinutes}m</p>
                        <p><strong>Pr≈Ømƒõr na den:</strong> ${workDays > 0 ? Math.round(totalWorkMinutes / workDays / 60 * 100) / 100 : 0}h</p>
                    </div>
                </body>
                </html>
            `;
            
            downloadFile(html, fileName + '.xls', 'application/vnd.ms-excel;charset=utf-8;');
        }

        function downloadFile(content, fileName, contentType) {
            const a = document.createElement('a');
            const file = new Blob(['\ufeff' + content], { type: contentType });
            a.href = URL.createObjectURL(file);
            a.download = fileName;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
        }

        // Event listenery pro Enter kl√°vesy
        document.addEventListener('DOMContentLoaded', function() {
            const usernameInput = document.getElementById('username');
            const passwordInput = document.getElementById('password');
            
            if (usernameInput) {
                usernameInput.addEventListener('keypress', function(e) {
                    if (e.key === 'Enter') {
                        login();
                    }
                });
            }
            
            if (passwordInput) {
                passwordInput.addEventListener('keypress', function(e) {
                    if (e.key === 'Enter') {
                        login();
                    }
                });
            }
        });
    </script>
</body>
</html>
